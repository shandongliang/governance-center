"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _row=require("antd/es/row"),_row2=_interopRequireDefault(_row),_button=require("antd/es/button"),_button2=_interopRequireDefault(_button),_input=require("antd/es/input"),_input2=_interopRequireDefault(_input),_form=require("antd/es/form"),_form2=_interopRequireDefault(_form);require("antd/es/row/style"),require("antd/es/button/style"),require("antd/es/input/style"),require("antd/es/form/style");var _react=require("react"),_react2=_interopRequireDefault(_react),_reactRouter=require("react-router"),_antd=require("antd"),_jsSha=require("js-sha256"),_jsSha2=_interopRequireDefault(_jsSha),_$fetch=require("$fetch"),_$fetch2=_interopRequireDefault(_$fetch),_store=require("../util/store"),_history=require("../util/history"),_index=require("../constant/index"),_index2=_interopRequireDefault(_index),_tabRouter=require("../util/tabRouter.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}require("./index.less");var FormItem=_form2.default.Item,Login=function(){_inherits(n,_react.Component);var o=_createSuper(n);function n(e,t){var r;return _classCallCheck(this,n),r=o.call(this,e,t),_store.authStore.remove(_index2.default.AUTH_USER_INFO),_store.authStore.remove(_index2.default.AUTH_USER_ISLOGIN),_store.menuStore.remove(_index2.default.MENU_INFO),_store.cacheStore.remove(_index2.default.CACHE_DICT_LIST),_store.cacheStore.remove(_index2.default.CACHE_ORG_LIST),r.state={loading:!1},r}return _createClass(n,[{key:"render",value:function(){return _react2.default.createElement("div",{className:"login"},_react2.default.createElement("div",{className:"form"},_react2.default.createElement("div",{className:"logo"},_react2.default.createElement("img",{alt:"logo",src:_index2.default.PROJECT_LOGO}),_react2.default.createElement("span",null,_index2.default.PROJECT_NAME)),_react2.default.createElement(WrapperLoginForm,null)))}}]),n}();exports.default=Login;var LoginForm=function(){_inherits(r,_react2.default.Component);var t=_createSuper(r);function r(e){var f;return _classCallCheck(this,r),_defineProperty(_assertThisInitialized(f=t.call(this,e)),"handleLogin",function(){(0,f.props.form.validateFieldsAndScroll)(function(e,t){var r;e||(r=(0,_jsSha2.default)(t.password),(0,_$fetch2.default)({url:"/"+_index.BACKSTAGE_PROJ_NAME+"/rbac/login",data:{loginName:t.loginName,password:r}}).then(function(e){var t,r,o,n=e.reply.user,a=(e.reply.menuList,e.reply.sysDictList),u=e.reply.sysOrgList,i=e.reply.roleInfo,s=e.reply.subsysList,l=e.reply.multisubsysType;if(f.setStoreData(n,s,!0,"/",a,u,l,i),_index2.default.NEED_HOME_INDEX){if(_store.authStore.get(_index2.default.FROM_HOME_INDEX)){var _=e.reply.menuList;return _store.menuStore.set(_index2.default.MENU_INFO,_),_store.navStore.set(_index2.default.NAV_LIST,(0,_tabRouter.getNavListFromMenuList)(_)),!1}_history.history.push(_index2.default.LOGINED_SELFHOME_URL)}else{f.setState({multisubsysType:l}),"select"===l?(t=e.reply.subsysList,_store.authStore.set(_index2.default.SUB_SYSTEM_LIST,t),_history.history.push(_index2.default.SHOW_SUBSYSTEM_URL)):"false"!==l&&"multi"!==l&&l||(r=e.reply.menuList,o=e.reply.permType,_store.authStore.set(_index2.default.CURRENT_PERMTYPE,o),_store.menuStore.set(_index2.default.MENU_INFO,r),_store.navStore.set(_index2.default.NAV_LIST,(0,_tabRouter.getNavListFromMenuList)(r)),_history.history.push("/"))}}))})}),_defineProperty(_assertThisInitialized(f),"setStoreData",function(e,t,r,o,n,a,u,i){_store.authStore.set(_index2.default.AUTH_USER_INFO,e),_store.authStore.set(_index2.default.SUBSYSLIST,t),_store.authStore.set(_index2.default.AUTH_USER_ISLOGIN,r),_store.authStore.set(_index2.default.INIT_URL,o),_store.cacheStore.set(_index2.default.CACHE_DICT_LIST,n),_store.cacheStore.set(_index2.default.CACHE_ORG_LIST,a),_store.cacheStore.set(_index2.default.CACHE_ROLE_INFO,i),_store.authStore.set(_index2.default.MULTISUBSYSTYPE,u)}),f}return _createClass(r,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return _react2.default.createElement(_form2.default,null,_react2.default.createElement(FormItem,{hasFeedback:!0},e("loginName",{rules:[{required:!0}]})(_react2.default.createElement(_input2.default,{size:"large",onPressEnter:this.handleLogin,placeholder:"请输入用户名"}))),_react2.default.createElement(FormItem,{hasFeedback:!0},e("password",{rules:[{required:!0}]})(_react2.default.createElement(_input2.default,{size:"large",type:"password",onPressEnter:this.handleLogin,placeholder:"请输入密码"}))),_react2.default.createElement(_row2.default,null,_react2.default.createElement(_button2.default,{type:"primary",size:"large",onClick:this.handleLogin},"登录")))}}]),r}(),WrapperLoginForm=_form2.default.create()(LoginForm);module.exports=exports.default;
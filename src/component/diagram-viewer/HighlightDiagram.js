"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_react2=_interopRequireDefault(_react),_raphael=require("raphael"),Raphael=_interopRequireWildcard(_raphael),_reactServiceflowDiagram=require("react-serviceflow-diagram");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&((r=n?Object.getOwnPropertyDescriptor(e,o):null)&&(r.get||r.set)?Object.defineProperty(i,o,r):i[o]=e[o])}return i.default=e,t&&t.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _objectWithoutProperties(e,t){if(null==e)return{};var r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),o=0;o<n.length;o++)r=n[o],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r]);return i}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var r,i={},n=Object.keys(e),o=0;o<n.length;o++)r=n[o],0<=t.indexOf(r)||(i[r]=e[r]);return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var i=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,i?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function firstUpperCase(e){return"".concat(e[0].toUpperCase()).concat(e.slice(1))}var TYPE_MAPPING={intermediateSignalCatch:{type:"IntermediateCatchEvent",eventDefinition:{type:"signal"}},intermediateSignalThrow:{type:"IntermediateThrowEvent",eventDefinition:{type:"signal"}},intermediateMessageCatch:{type:"IntermediateCatchEvent",eventDefinition:{type:"message"}},intermediateTimer:{type:"IntermediateCatchEvent",eventDefinition:{type:"timer"}},"boundaryEvent-errorEventDefinition":{type:"BoundaryEvent",eventDefinition:{type:"error"}},"endEvent-errorEventDefinition":{type:"ThrowEvent",eventDefinition:{type:"error"}},"boundaryEvent-compensateEventDefinition":{type:"BoundaryEvent",eventDefinition:{type:"compensate"}},"throwEvent-compensateEventDefinition":{type:"ThrowEvent",eventDefinition:{type:"compensate"}},boundaryTimer:{type:"BoundaryEvent",eventDefinition:{type:"timer"}},callActivity:{type:"CallActivity"}},HighlightDiagram=function(){_inherits(n,_react.Component);var i=_createSuper(n);function n(e){var u;_classCallCheck(this,n),_defineProperty(_assertThisInitialized(u=i.call(this,e)),"onClickHandler",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.type&&u.props.onClick&&u.props.onClick(e)}),_defineProperty(_assertThisInitialized(u),"onHoverHandler",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.type&&u.props.onHover&&u.props.onHover(e)}),_defineProperty(_assertThisInitialized(u),"getDiagramModel",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d={activities:{},flows:{}},h={elements:[],flows:[],associations:[]},v={},g=e.activities&&e.activities[0]&&e.activities[0].x,_=e.activities&&e.activities[0]&&e.activities[0].y,m=0,b=0,r=0;e.activities&&e.activities.forEach(function(e){e.y<r&&(r=e.y)});var P=Math.abs(r);_+=P;var i=t.activities,n=void 0===i?[]:i,o=t.flows,a=void 0===o?[]:o,c=t.curActivities,s=void 0===c?[]:c;return n.forEach(function(e){d.activities[e]={completed:!0,current:!1}}),s.forEach(function(e){d.activities[e].current=!0}),a.forEach(function(e){d.flows[e]=!0}),e.activities&&e.activities.forEach(function(e){var t=e.x,r=e.width,i=e.height,n=e.activityId,o=e.properties,a=o.name,c=o.type,s=(_objectWithoutProperties(o,["name","type"]),e.y);t<g&&(g=t),(s+=P)<_&&(_=s),m<t+r&&(m=t+r+10),b<s+i&&(b=s+i+10);var u=TYPE_MAPPING[c]||{},l=u.type,f=_objectWithoutProperties(u,["type"]),p=[{name:"activityId",value:e.activityId}],y=Object.assign({x:t,y:s,width:r,height:i,id:n,name:a,type:l||firstUpperCase(c),properties:p,completed:!(!d.activities[n]||!d.activities[n].completed),current:!(!d.activities[n]||!d.activities[n].current)},f);v[n]=y,h.elements.push(y)}),e.sequenceFlows&&e.sequenceFlows.forEach(function(e){var t=e.flow,r=e.id,i=e.xPointArray,n=e.yPointArray,o=t.match(/\((.*)\)--.*-->\((.*)\)/),a=o?o[1]:null,c=o?o[2]:null,s=i.map(function(e,t){return m<e&&(m=e+5),n[t]=n[t]+P,n[t]>b&&(b=n[t]+5),{x:e,y:n[t]}});a&&v[a]&&c&&v[c]&&(s=u.connectFlowToActivity(v[a],v[c],s)),h.flows.push({id:r,sourceRef:a,targetRef:c,type:"sequenceFlow",completed:!!d.flows[r],current:!1,properties:[],waypoints:s})}),e.associations&&e.associations.forEach(function(e){var t=e.flow,r=e.id,i=e.xPointArray,n=e.yPointArray,o=t.match(/\((.*)\)--.*-->\((.*)\)/),a=o?o[1]:null,c=o?o[2]:null,s=i.map(function(e,t){return m<e&&(m=e+5),n[t]=n[t]+P,n[t]>b&&(b=n[t]+5),{x:e,y:n[t]}});a&&v[a]&&c&&v[c]&&(s=u.connectFlowToActivity(v[a],v[c],s)),h.associations.push({id:r,sourceRef:a,targetRef:c,type:"association",completed:!1,current:!!d.flows[r],properties:[],waypoints:s})}),h.diagramBeginX=0,h.diagramBeginY=0,h.diagramWidth=m,h.diagramHeight=b,h.properties=[],new _reactServiceflowDiagram.DiagramModel(h)}),_defineProperty(_assertThisInitialized(u),"getRectPath",function(e){var t=e.x,r=e.y,i=e.width,n=e.height;return["M ".concat(t," ").concat(r),"L ".concat(t+i," ").concat(r),"L ".concat(t+i," ").concat(r+n),"L ".concat(t," ").concat(r+n)]}),_defineProperty(_assertThisInitialized(u),"connectFlowToActivity",function(e,t,r){var i=[],n=[];r.forEach(function(e,t){n.push([0===t?"M":"L",e.x,e.y]),i.push({x:e.x,y:e.y})}),n[0][1]=e.x+e.width/2,n[0][2]=e.y+e.height/2,n[n.length-1][1]=t.x+t.width/2,n[n.length-1][2]=t.y+t.height/2;var o=Raphael.pathIntersection(u.getRectPath(e),n),a=Raphael.pathIntersection(u.getRectPath(t),n),c=o.pop(),s=a.pop();return void 0!==c&&(i[0].x=c.x,i[0].y=c.y),void 0!==s&&(i[i.length-1].x=s.x,i[i.length-1].y=s.y),i});var t=e.diagram,r=e.highlight;return(0,_reactServiceflowDiagram.config)({CURRENT_COLOR:"#c05917",COMPLETED_COLOR:"#66AA66"}),u.state={diagram:u.getDiagramModel(t,r)},u}return _createClass(n,[{key:"componentWillReceiveProps",value:function(e){var t=e.diagram,r=e.highlight;this.setState({diagram:this.getDiagramModel(t,r)})}},{key:"render",value:function(){return _react2.default.createElement("div",{style:{width:"100%",overflow:"auto",marginBottom:15}},this.state.diagram?_react2.default.createElement(_reactServiceflowDiagram.Diagram,{diagram:this.state.diagram,onClick:this.onClickHandler,onHover:this.onHoverHandler}):null)}}]),n}();_defineProperty(HighlightDiagram,"defaultProps",{onClick:function(){}}),exports.default=HighlightDiagram,module.exports=exports.default;
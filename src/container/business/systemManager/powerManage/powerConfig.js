"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _modal=require("antd/es/modal"),_modal2=_interopRequireDefault(_modal),_row=require("antd/es/row"),_row2=_interopRequireDefault(_row),_col=require("antd/es/col"),_col2=_interopRequireDefault(_col),_table=require("antd/es/table"),_table2=_interopRequireDefault(_table),_icon=require("antd/es/icon"),_icon2=_interopRequireDefault(_icon),_input=require("antd/es/input"),_input2=_interopRequireDefault(_input),_button=require("antd/es/button"),_button2=_interopRequireDefault(_button),_message2=require("antd/es/message"),_message3=_interopRequireDefault(_message2),_tabs=require("antd/es/tabs"),_tabs2=_interopRequireDefault(_tabs);require("antd/es/modal/style"),require("antd/es/row/style"),require("antd/es/col/style"),require("antd/es/table/style"),require("antd/es/icon/style"),require("antd/es/input/style"),require("antd/es/button/style"),require("antd/es/message/style"),require("antd/es/tabs/style");var _react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_antd=require("antd"),_fetch=require("./../../../../util/fetch"),_fetch2=_interopRequireDefault(_fetch),_tabRouter=require("./../../../../util/tabRouter.js"),_index=require("./../../../../constant/index");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(t,e){var n,a=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)),a}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var a=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,a?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}require("./../../../common/style/index.less");var TabPane=_tabs2.default.TabPane,PowerConfig=function(){_inherits(n,_react.Component);var t=_createSuper(n);function n(e){var l;return _classCallCheck(this,n),_defineProperty(_assertThisInitialized(l=t.call(this,e)),"deleteMenu",function(a){return function(){var e=l.state.queryParams.permissionId,n=l.state.menuList;(0,_fetch2.default)({url:"/"+_index.BACKSTAGE_PROJ_NAME+"/rbac/doConfigPerm",data:{permId:e,type:"menu",cancel:!0,relationId:a}}).then(function(e){if("S"==e.reply.returnCode.type){for(var t=0;t<n.length;t++)if(a==n[t].menuId){n.splice(t,1);break}l.setState({menuList:n})}})}}),_defineProperty(_assertThisInitialized(l),"deleteFunc",function(r){return function(){for(var e=l.state.selectedRowKeys,t=0;t<e.length;t++)if(e[t]==r){e.splice(t,1);break}var n=l.state.queryParams.permissionId,a=l.state.funcList;(0,_fetch2.default)({url:"/"+_index.BACKSTAGE_PROJ_NAME+"/rbac/doConfigPerm",data:{permId:n,type:"func",cancel:!0,relationId:r}}).then(function(e){if("S"==e.reply.returnCode.type){for(var t=0;t<a.length;t++)if(r==a[t].name){a.splice(t,1);break}l.setState({funcList:a})}})}}),_defineProperty(_assertThisInitialized(l),"fetchData",function(){l.setState({loading:!0});var e=l.state.queryParams.permissionId;(0,_fetch2.default)({url:"/"+_index.BACKSTAGE_PROJ_NAME+"/rbac/queryPermDetailForConfig",data:{permId:e}}).then(function(e){if("S"==e.reply.returnCode.type){for(var t=e.reply.funcList,n=e.reply.menuList,a=0;a<t.length;a++)t[a].key=t[a].name;for(var r=0;r<n.length;r++)n[r].key=n[r].menuId;l.setState({funcList:t,menuList:n,loading:!1})}})}),_defineProperty(_assertThisInitialized(l),"addFuncTableChangeHandle",function(e){l.setState({pagination:e},function(){var e=l.state.funcName,t={};null!=e&&""!=e&&""!=e.trim()&&(t.funcName=e),l.queryFuncList(t)})}),_defineProperty(_assertThisInitialized(l),"queryFuncList",function(e){l.setState({loading:!0});var t=l.state.queryParams.permissionId;e.permId=t,e.pageNo=l.state.pagination.current,e.recordsPerPage=l.state.pagination.pageSize,(0,_fetch2.default)({url:"/"+_index.BACKSTAGE_PROJ_NAME+"/rbac/showFuncsToAddPerm",data:e}).then(function(e){if("S"==e.reply.returnCode.type){var t=l.state.pagination;t.total=e.reply.page.total,t.current=e.reply.page.pageNo;var n=e.reply.funcList;if(null!=n&&0<n.length)for(var a=0;a<n.length;a++)n[a].key=n[a].name;l.setState({data:n,loading:!1,pagination:t})}})}),_defineProperty(_assertThisInitialized(l),"queryMenuList",function(e){l.setState({loading:!0});var t=l.state.queryParams.permissionId;e.permId=t,(0,_fetch2.default)({url:"/"+_index.BACKSTAGE_PROJ_NAME+"/rbac/showMenusToAddPerm",data:e}).then(function(e){if("S"==e.reply.returnCode.type){var t=e.reply.menuList,n=e.reply.alreadyConfigedMenuList;if(null!=t&&0<t.length&&null!=n&&0<n.length)for(var a=0;a<t.length;a++)for(var r=0;r<n.length;r++)if(t[a].menuId==n[r].menuId){t[a].alreadyConfiged=!0;break}var i=l.createPermTree(t);l.setState({menuListAdd:i,loading:!1})}})}),_defineProperty(_assertThisInitialized(l),"createPermTree",function(e){var t,n=new Array,a={};for(var r in e){e[r].key=r,(t=e[r]).children=new Array,a[t.menuId]=t}for(var r in e.sort(l.sortBy("sort")),e){(t=e[r]).parentMenuId in a?a[t.parentMenuId].children.push(t):n.push(t)}return n=l.deleteChildren(n)}),_defineProperty(_assertThisInitialized(l),"sortBy",function(r){return function(e,t){var n,a;if("object"===_typeof(e)&&"object"===_typeof(t)&&e&&t)return(n=e[r])===(a=t[r])?0:_typeof(n)===_typeof(a)?n<a?-1:1:_typeof(n)<_typeof(a)?-1:1;throw"error"}}),_defineProperty(_assertThisInitialized(l),"deleteChildren",function(e){for(var t in e){var n=e[t];0==n.children.length?delete n.children:l.deleteChildren(n.children)}return e}),_defineProperty(_assertThisInitialized(l),"handlerQuery",function(){var e=l.state.funcName,t={};null!=e&&""!=e&&""!=e.trim()&&(t.funcName=e),l.queryFuncList(t)}),_defineProperty(_assertThisInitialized(l),"handlerClear",function(){l.setState({funcName:"",pagination:{pageSize:5,pageSizeChanger:!0,current:1}})}),_defineProperty(_assertThisInitialized(l),"toAddFunc",function(){l.setState({visible:!0}),l.queryFuncList({})}),_defineProperty(_assertThisInitialized(l),"handleChange2",function(n){return function(e){var t={};t[n]=e.target.value,l.setState(t)}}),_defineProperty(_assertThisInitialized(l),"handleOk",function(){var e,t=l.state.selectedRowKeys;null!=t&&""!=t&&0!=t.length?(l.setState({visible:!1,loading:!0}),e=l.state.queryParams.permissionId,(0,_fetch2.default)({url:"/"+_index.BACKSTAGE_PROJ_NAME+"/rbac/addPermFunc",data:{permId:e,funcNames:t}}).then(function(e){"S"==e.reply.returnCode.type&&l.fetchData()})):_message3.default.info("请先选择Function")}),_defineProperty(_assertThisInitialized(l),"addMenu",function(t){return function(){l.setState({visibleMenu:!1,loading:!0});var e=l.state.queryParams.permissionId;(0,_fetch2.default)({url:"/"+_index.BACKSTAGE_PROJ_NAME+"/rbac/doConfigPerm",data:{permId:e,relationId:t,cancel:!1,type:"menu"}}).then(function(e){"S"==e.reply.returnCode.type&&l.fetchData()})}}),_defineProperty(_assertThisInitialized(l),"handleCancel",function(){l.setState({visible:!1})}),_defineProperty(_assertThisInitialized(l),"handleCancelMenu",function(){l.setState({visibleMenu:!1})}),_defineProperty(_assertThisInitialized(l),"tabChange",function(e){1==e?l.queryFunction():l.queryMenu()}),_defineProperty(_assertThisInitialized(l),"queryMenu",function(){var e=_reactDom2.default.findDOMNode(l.refs.funcDetail),t=_reactDom2.default.findDOMNode(l.refs.menuDetail);e.style.display="none",t.style.display="block"}),_defineProperty(_assertThisInitialized(l),"queryFunction",function(){var e=_reactDom2.default.findDOMNode(l.refs.funcDetail),t=_reactDom2.default.findDOMNode(l.refs.menuDetail);e.style.display="block",t.style.display="none"}),_defineProperty(_assertThisInitialized(l),"toAddMenu",function(){l.setState({visibleMenu:!0}),l.queryMenuList({})}),_defineProperty(_assertThisInitialized(l),"handlerBack",function(){var e={pathname:"/systemManage/powerManager/powerQur",state:_objectSpread({},l.state.queryParams)};(0,_tabRouter.goToAndClose)(e)}),l.state={loading:!1,permId:"",pagination:{pageSize:5,pageSizeChanger:!0,current:1},visible:!1,visibleMenu:!1,selectedRowKeys:[],columnsFunc:[{title:"Function名称",dataIndex:"name",width:"25%"},{title:"描述",dataIndex:"description",width:"50%"},{title:"操作",dataIndex:"",width:"25%",render:function(e,t){var n=t.name;return _react2.default.createElement(_button2.default,{className:"pandora-btn-fontsize",size:"small",onClick:l.deleteFunc(n),style:{width:88,borderRadius:3,height:26}},"解除")}}],columnsFuncAdd:[{title:"Function名称",dataIndex:"name"},{title:"描述",dataIndex:"description"}],columnsMenu:[{title:"菜单名称",width:"25%",dataIndex:"menuName"},{title:"action",width:"50%",dataIndex:"action"},{title:"操作",width:"25%",dataIndex:"",render:function(e,t){var n=t.menuId;return _react2.default.createElement(_button2.default,{className:"pandora-btn-fontsize",size:"small",onClick:l.deleteMenu(n),style:{width:88,fontSize:12,borderRadius:3,height:26}},"解除")}}],columnsMenuAdd:[{title:"菜单名称",dataIndex:"menuName",className:"menuName"},{title:"action",dataIndex:"action"},{title:"操作",dataIndex:"",render:function(e,t){var n=t.menuId;return t.alreadyConfiged?_react2.default.createElement("span",null):_react2.default.createElement("span",null,_react2.default.createElement(_input2.default,{style:{width:"50px",backgroundColor:"#009857",fontWeight:"bold",color:"white",borderRadius:3},type:"button",onClick:l.addMenu(n),value:"添加",className:"addNemu"}))}}],queryParams:l.props.location.state},l}return _createClass(n,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"render",value:function(){var a=this,e={selectedRowKeys:this.state.selectedRowKeys,onChange:function(e){a.setState({selectedRowKeys:e},null)},onSelect:function(e,t,n){a.setState({selectedRows:n},null)},onSelectAll:function(e,t){a.setState({selectedRows:t},null)}};return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"pandora-main-content"},_react2.default.createElement("div",{className:"portlet-tab"},_react2.default.createElement(_tabs2.default,{type:"line",onChange:this.tabChange},_react2.default.createElement(TabPane,{tab:_react2.default.createElement("a",{href:"javascript:void(0);",style:{textDecoration:"none"}},"Function"),key:"1",onTabClick:this.queryFunction}),_react2.default.createElement(TabPane,{tab:_react2.default.createElement("a",{href:"javascript:void(0);",style:{textDecoration:"none"}},"菜单"),key:"2",onTabClick:this.queryMenu})),_react2.default.createElement("div",{className:"portlet-body",ref:"funcDetail"},_react2.default.createElement("div",{className:"role-table"},_react2.default.createElement("div",{className:"role-header"},_react2.default.createElement("div",{className:"role-list"},"Function列表"),_react2.default.createElement("div",{className:"role-create1",onClick:this.toAddFunc},_react2.default.createElement(_icon2.default,{className:"role-icon",type:"plus"}),_react2.default.createElement("span",null," 添  加 "))),_react2.default.createElement("div",null,_react2.default.createElement(_table2.default,{rowKey:function(e){return e.name},pagination:!1,loading:this.state.loading,dataSource:this.state.funcList,columns:this.state.columnsFunc}))),_react2.default.createElement(_button2.default,{className:"query-btn pandora-btn-fontsize",onClick:this.handlerBack,style:{marginTop:20}},"返回")),_react2.default.createElement("div",{className:"modal"},_react2.default.createElement(_modal2.default,{title:"添加Function权限",visible:this.state.visible,width:926,onOk:this.handleOk,onCancel:this.handleCancel},_react2.default.createElement(_row2.default,null,_react2.default.createElement(_col2.default,{span:18,offset:1},_react2.default.createElement("span",{style:{width:100,marginTop:15,display:"inline-block"}},"Function名称:"),_react2.default.createElement(_input2.default,{style:{width:200,marginTop:15,height:32,display:"inline"},placeholder:"",size:"default",name:"funcName",value:this.state.funcName,onChange:this.handleChange2("funcName")}),_react2.default.createElement(_button2.default,{className:"query-btn operatorBtn pandora-btn-fontsize",onClick:this.handlerQuery},"查询"),_react2.default.createElement(_button2.default,{className:"query-btn pandora-btn-fontsize",onClick:this.handlerClear},"清空"))),_react2.default.createElement(_table2.default,{rowKey:function(e){return e.name},pagination:this.state.pagination,loading:this.state.loading,dataSource:this.state.data,columns:this.state.columnsFuncAdd,onChange:this.addFuncTableChangeHandle,rowSelection:e,style:{paddingLeft:10,paddingRight:10}}))),_react2.default.createElement("div",{className:"portlet-body",style:{display:"none"},ref:"menuDetail"},_react2.default.createElement("div",{className:"role-table"},_react2.default.createElement("div",{className:"role-header"},_react2.default.createElement("div",{className:"role-list"},"菜单列表"),_react2.default.createElement("div",{className:"role-create1",onClick:this.toAddMenu},_react2.default.createElement(_icon2.default,{className:"role-icon",type:"plus"}),_react2.default.createElement("span",null," 添  加 "))),_react2.default.createElement("div",null,_react2.default.createElement(_table2.default,{rowKey:function(e){return e.menuId},pagination:!1,loading:this.state.loading,dataSource:this.state.menuList,columns:this.state.columnsMenu}))),_react2.default.createElement(_button2.default,{className:"query-btn pandora-btn-fontsize",onClick:this.handlerBack,style:{marginTop:20}},"返回")),_react2.default.createElement("div",null,_react2.default.createElement(_modal2.default,{width:926,title:"添加菜单权限",visible:this.state.visibleMenu,onCancel:this.handleCancelMenu,footer:null},_react2.default.createElement(_table2.default,{rowKey:function(e){return e.menuId},pagination:!1,loading:this.state.loading,dataSource:this.state.menuListAdd,columns:this.state.columnsMenuAdd,style:{paddingLeft:10,paddingRight:10}}))))))}}]),n}();exports.default=PowerConfig,module.exports=exports.default;
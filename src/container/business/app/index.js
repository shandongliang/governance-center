"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_react2=_interopRequireDefault(_react),_antd=require("antd"),_layout=require("./layout.js"),_layout2=_interopRequireDefault(_layout),_index=require("./../../../component/header-antd/index"),_index2=_interopRequireDefault(_index),_Menu=require("./../../../component/menu/Menu"),_Menu2=_interopRequireDefault(_Menu),_index3=require("./../../../component/tab-nav/index"),_index4=_interopRequireDefault(_index3),_index5=require("../../../constant/index"),_index6=_interopRequireDefault(_index5),_store=require("../../../util/store"),_tabRouter=require("../../../util/tabRouter.js"),_$fetch=require("$fetch");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}require("./index.less");var App=function(){_inherits(o,_react.Component);var r=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),_defineProperty(_assertThisInitialized(t=r.call(this,e)),"setStoreData",function(e,t,r,o,n,u,i,s,a,l,_){_store.userStore.set(_index6.default.LOCAL_USER_NAME,e.userName),_store.authStore.set(_index6.default.AUTH_USER_INFO,e),_store.authStore.set(_index6.default.SUB_SYSTEM_LIST,t),_store.authStore.set(_index6.default.AUTH_USER_ISLOGIN,r),_store.cacheStore.set(_index6.default.CACHE_DICT_LIST,o),_store.cacheStore.set(_index6.default.CACHE_ORG_LIST,n),_store.cacheStore.set(_index6.default.CACHE_ROLE_INFO,s),_store.authStore.set(_index6.default.INIT_URL,u),_store.authStore.set(_index6.default.MULTISUBSYSTYPE,i),_store.authStore.set(_index6.default.IS_USE_SECURITY_ROLES,a),_store.authStore.set(_index6.default.IS_USE_ROLE_LEVEL,l),_store.authStore.set(_index6.default.CURRENT_SUPREME_ROLELEVEL,_)}),t.state={},t}return _createClass(o,[{key:"componentWillMount",value:function(){var x=this;(0,_$fetch.$fetchSync)("/"+_index6.default.BACKSTAGE_PROJ_NAME+"/rbac/checkOauth",{oriUrl:window.location.href},function(e){var t,r,o=e.reply.redirectURL,n=(e.reply.authorizeUrl,e.reply.clientCode,e.reply.initUrl),u=e.reply.user,i=e.reply.sysDictList,s=e.reply.sysOrgList,a=e.reply.roleInfo,l=e.reply.subsysList,_=e.reply.multisubsysType,f=o,c=e.reply.eleList,p=e.reply.useSecurityRoles,d=e.reply.isUseRoleLevel,y=e.reply.roleLevel,S="string"==typeof p?p.toLowerCase():p,E="string"==typeof d?d.toLowerCase():d;if(null!=c&&_store.authStore.set(_index6.default.CACHE_APP_ELEMENTLIST,c),_store.authStore.set(_index6.default.OAUTH_HREF,f),0==e.reply.isAuthorized)_index6.default.NEED_SELFHOME_PAGE&&_index6.default.LOGIN_SELFHOME_URL?x.props.history.replace(_index6.default.LOGIN_SELFHOME_URL):(_store.authStore.remove(_index6.default.SELECTED_MULTISUBSYS),_store.authStore.remove(_index6.default.FROM_HOME_INDEX),window.location.href=f);else if(1==e.reply.isAuthorized){if(x.setStoreData(u,l,!0,i,s,n,_,a,S,E,y),_index6.default.NEED_HOME_INDEX&&_index6.default.LOGINED_SELFHOME_URL){var h=_store.authStore.get(_index6.default.FROM_HOME_INDEX),L=e.reply.menuList;if(h){if(L&&0!==L.length)return _store.menuStore.set(_index6.default.MENU_INFO,L),_store.navStore.set(_index6.default.NAV_LIST,(0,_tabRouter.getNavListFromMenuList)(L)),!1;null!=L&&0!=L.length||x.props.history.replace("/home")}else x.props.history.replace(_index6.default.LOGINED_SELFHOME_URL)}else{if(x.setState({multisubsysType:_}),"select"===_)return _store.authStore.get(_index6.default.SELECTED_MULTISUBSYS)||x.props.history.replace(_index6.default.SHOW_SUBSYSTEM_URL),!1;"false"!==_&&"multi"!==_&&_||(t=e.reply.menuList,r=e.reply.permType,_store.menuStore.set(_index6.default.MENU_INFO,t),_store.navStore.set(_index6.default.NAV_LIST,(0,_tabRouter.getNavListFromMenuList)(t)),_store.authStore.set(_index6.default.CURRENT_PERMTYPE,r),x.props.history.replace("/home"))}"false"==S&&"true"==E&&a&&a.map(function(e){var t;e.roleLevel||(t=e.roleName+" 角色的 roleLevel 未设置，请为该角色设置 roleLevel",console.error(t))})}})}},{key:"componentDidUpdate",value:function(){document.getElementsByClassName("pandora-layout")[0]&&(document.getElementsByClassName("pandora-layout")[0].scrollTop=0)}},{key:"render",value:function(){var e=this.state.multisubsysType,t=_store.authStore.get(_index6.default.SELECTED_MULTISUBSYS),r=_store.userStore.get(_index6.default.LOCAL_USER_NAME);if(_store.authStore.has(_index6.default.AUTH_USER_INFO)){var o=this.props.location.pathname.replace(new RegExp("/","g"),"_");return _react2.default.createElement(_layout2.default,{children:this.props.children,pathName:o,routes:this.props.routes,params:this.props.params,multisubsysType:e,selectedMultisubsys:t,userName:r})}return null}}]),o}();exports.default=App,module.exports=exports.default;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _tabs=require("antd/es/tabs"),_tabs2=_interopRequireDefault(_tabs);require("antd/es/tabs/style");var _react=require("react"),_react2=_interopRequireDefault(_react),_antd=require("antd"),_tabRouter=require("../../../../util/tabRouter.js"),_index=require("../../../../constant/index.js");require("./../../../common/style/index.less");var _queryComponent=require("../../../../component/busiProcess/queryComponent.js"),_queryComponent2=_interopRequireDefault(_queryComponent),_tableComponent=require("../../../../component/busiProcess/tableComponent.js"),_tableComponent2=_interopRequireDefault(_tableComponent),_index2=require("./../../../../constant/index"),_index3=_interopRequireDefault(_index2),_store=require("./../../../../util/store"),_$fetch=require("$fetch"),_$fetch2=_interopRequireDefault(_$fetch),_defaultConfig=require("./defaultConfig.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var a,r=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,a)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(a){var r=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(a);return _possibleConstructorReturn(this,r?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var TabPane=_tabs2.default.TabPane,RoleTodotaskIndexTask=function(){_inherits(a,_react.Component);var t=_createSuper(a);function a(e){var l;return _classCallCheck(this,a),_defineProperty(_assertThisInitialized(l=t.call(this,e)),"fetchTableData",function(c){var e={pageNo:l.state.pagination.current,recordsPerPage:l.state.pagination.pageSize};(0,_$fetch2.default)({url:"/"+_index2.BACKSTAGE_PROJ_NAME+"/workflow/queryPostRuTask",data:_objectSpread(_objectSpread({},c),e)}).then(function(e){var t=e.reply.postProcConfColumn,a=l.state.queryParams.groupId,r=(0,_defaultConfig.defaultConfig)(_assertThisInitialized(l))[a]?(0,_defaultConfig.defaultConfig)(_assertThisInitialized(l))[a].scrollXWidth:"",o=[],n=200;t.map(function(e){"1"==e.isDisplaytable&&(o.push(e),e.columnWidth?n+=parseInt(e.columnWidth):n+=100)});var i=r||n;l.setState({groupId:c.groupId,isQueryCriteria:o});t.push({columnAlias:"operationAdd",columnDataType:"VARCHAR",columnDec:"操作",columnName:"操作",columnWidth:"",isDisplaytable:"1",isQueryCriteria:"0"});var s=e.reply.page,u=l.state.pagination;u.total=s.total,u.current=s.pageNo,l.setState({pagination:u,params:c,columns:t,dataSource:e.reply.postRuTask,configKey:c.groupId,scroll:{x:i},rowKey:"taskId",parentThis:_assertThisInitialized(l)})})}),_defineProperty(_assertThisInitialized(l),"handleSearchTableData",function(e){(l.state.formQueryData=e).groupId||(e.groupId=e.busiLabel),e.orgIds||(e.orgIds=l.state.queryParams.orgIds),e.busiLabel&&delete e.busiLabel,l.fetchTableData(e)}),_defineProperty(_assertThisInitialized(l),"tablePaginationSearch",function(e){l.setState({pagination:e},function(){l.fetchTableData(l.state.params)})}),_defineProperty(_assertThisInitialized(l),"toSignOut",function(e){return function(){(0,_$fetch2.default)({url:"/"+_index2.BACKSTAGE_PROJ_NAME+"/workflow/signOutTask",data:{taskId:e.taskId}}).then(function(e){var t=_objectSpread(_objectSpread(_objectSpread({},l.state.queryParams),l.state.formQueryData),{},{latitude:l.state.latitude});l.fetchTableData(t)})}}),_defineProperty(_assertThisInitialized(l),"toSign",function(t){return function(){var e=t.taskId;(0,_$fetch2.default)({url:"/"+_index2.BACKSTAGE_PROJ_NAME+"/workflow/signInTask",data:{taskId:e}}).then(function(e){var t;"S"===e.reply.returnCode.type&&("workflow.signInTask.taskAlreadyClaimed"===e.reply.result.code?Modal.warning({title:e.reply.result.message,okText:"确定",onOk:l.toSignSuccess}):(t=_objectSpread(_objectSpread(_objectSpread({},l.state.queryParams),l.state.formQueryData),{},{latitude:l.state.latitude}),l.fetchTableData(t)))})}}),_defineProperty(_assertThisInitialized(l),"toForceSignIn",function(t){return function(){var e=t.taskId;(0,_$fetch2.default)({url:"/"+_index2.BACKSTAGE_PROJ_NAME+"/workflow/forceSignInTask",data:{taskId:e}}).then(function(e){var t;"S"===e.reply.returnCode.type&&(t=_objectSpread(_objectSpread(_objectSpread({},l.state.queryParams),l.state.formQueryData),{},{latitude:l.state.latitude}),l.fetchTableData(t))})}}),_defineProperty(_assertThisInitialized(l),"getPathDueToAssignee",function(e){var t,a=_store.authStore.get(_index3.default.AUTH_USER_INFO).userId,r=e.assignee,o="",n="";return n=r&&r==a?(o={pathname:_index.IS_OPEN_MULTI_TABNAV?"/processManager/mytodotask/tdetail/"+e.taskId:"/processManager/mytodotask/tdetail",state:_objectSpread(_objectSpread(_objectSpread({},l.state.queryParams),l.state.formQueryData),{},{latitude:l.state.latitude,pagination:l.state.pagination,taskDefinitionKey:e.taskDefinitionKey,processDefinitionId:e.procDefId,processInstanceId:e.procInstId,taskId:e.taskId,pathName:"/processManager/roleTodotask/indexTask",tabName:"办理待办业务"})},"办理待办业务"):(t=!!r,o={pathname:"/processManager/roleTodoTask/waitPickup/taskDetail",state:_objectSpread(_objectSpread(_objectSpread({},l.state.queryParams),l.state.formQueryData),{},{latitude:l.state.latitude,pagination:l.state.pagination,taskId:e.taskId,processInstanceId:e.procInstId,isForceSignIn:t})},"任务签收"),{path:o,tabTitle:n}}),_defineProperty(_assertThisInitialized(l),"toTaskDetail",function(e){var t=l.getPathDueToAssignee(e);return function(){(0,_tabRouter.goTo)(t.path,t.tabTitle)}}),l.state={pagination:{pageSize:15,pageSizeChanger:!0,current:1},queryParams:l.props.location.state,latitude:"ROLE",formQueryData:{}},l}return _createClass(a,[{key:"componentDidMount",value:function(){var e={groupId:this.state.queryParams.groupId,procKey:this.state.queryParams.procKey,orgIds:this.state.queryParams.orgIds,latitude:this.state.latitude};this.fetchTableData(e)}},{key:"render",value:function(){return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"pandora-main-content"},_react2.default.createElement("div",{className:"portlet-tab"},_react2.default.createElement(_tabs2.default,{defaultActiveKey:"1",style:{marginBottom:7}},_react2.default.createElement(TabPane,{tab:"角色待办查询",key:"1"},_react2.default.createElement("div",{className:"portlet-body"},_react2.default.createElement("div",{className:"query-condition"},_react2.default.createElement(_queryComponent2.default,{formLayout:{formItemLayout:{labelCol:{span:6},wrapperCol:{span:18}},gridColLayout:{span:8,offset:1},gridButtonLayout:{span:8,offset:13}},busiLabel:this.state.queryParams.groupId,procKey:this.state.queryParams.procKey,latitude:this.state.latitude,isQueryCriteria:this.state.isQueryCriteria,getQueryData:this.handleSearchTableData})),_react2.default.createElement("div",{className:"role-table"},_react2.default.createElement("div",{className:"role-header"},_react2.default.createElement("div",{className:"role-list"},"角色待办任务列表"))),_react2.default.createElement(_tableComponent2.default,{scroll:this.state.scroll,rowKey:this.state.rowKey,parentThis:this.state.parentThis,columns:this.state.columns,dataSource:this.state.dataSource,configKey:this.state.configKey,pagination:this.state.pagination,defaultConfig:_defaultConfig.defaultConfig,handleTablePage:this.tablePaginationSearch,style:{paddingLeft:10,paddingRight:10}})))))))}}]),a}();exports.default=RoleTodotaskIndexTask,module.exports=exports.default;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pathConvertToCacheKey=exports.getPathCompFromKey=exports.isExisedTheUrl=exports.getNavListFromMenuList=exports.goToAndClose=exports.goTo=void 0;var _react=require("react"),_react2=_interopRequireDefault(_react),_reactRouterCacheRoute=require("react-router-cache-route"),_pathToRegexp=require("path-to-regexp"),_pathToRegexp2=_interopRequireDefault(_pathToRegexp),_store=require("./store"),_index=require("./../constant/index"),_index2=_interopRequireDefault(_index),_history=require("./history.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var goTo=function(e,t){commonTabRouterJump(e,t,!1,!1,!0)},goToAndClose=function(e,t,r){commonTabRouterJump(e,t,!0,!0,!(2<arguments.length&&void 0!==r)||r)},commonTabRouterJump=function(r,o,a,n,i){setTimeout(function(){var e=_history.history.location.pathname,t=r.pathname;a&&closeCurrTag(e),n&&clearPageCache(e),i&&clearPageCache(t),pushTabDataToNavList(o,r),_history.history.push(r)},0)},pushTabDataToNavList=function(e,t){var r,o=_store.navStore.get(_index2.default.NAV_LIST),a=t.pathname;pathIndexOfInNavList(a,o)<0&&(r={name:e,key:a,path:a},o.push(r),_store.navStore.set(_index2.default.NAV_LIST,o))},pathIndexOfInNavList=function(e,t){for(var r=0,o=t.length;r<o;r++){var a=t[r];if(a.path&&(0,_pathToRegexp2.default)(a.path).exec(e))return r}return-1},closeCurrTag=function(e){var t,r,o=_store.navStore.get(_index2.default.TABS),a=deleteElementFromArray(o,e);_store.navStore.set(_index2.default.TABS,a),-1!=e.indexOf("/processManager/mytodotask/tdetail")&&(t=e.lastIndexOf("/"),r=e.substring(t+1),_store.authStore.remove(_index2.default.CACHE_USERTASK_ELEMENTLIST+r))},deleteElementFromArray=function(e,t){for(var r=0;r<e.length;r++){var o=e[r];if(o.path&&(0,_pathToRegexp2.default)(o.path).exec(t)){e.splice(r,1);break}}return e},clearPageCache=function(e){var t=pathConvertToCacheKey(e);(0,_reactRouterCacheRoute.dropByCacheKey)(t)},getNavListFromMenuList=function(e){var i=[];return e.map(function(e,t){var r=e.menuName,o=e.menuId,a=e.unclosable,n="/"+e.action.replace(/\./g,"/");i.push({name:r,key:o,unclosable:a,path:n})}),i},isExisedTheUrl=function(e,t){for(var r=!1,o=0;o<e.length;o++){var a=e[o];if(a.path&&(0,_pathToRegexp2.default)(a.path).exec(t)){r=!0;break}}return r},getPathCompFromKey=function(e,t){var r=t.location.pathname.replace(/\//g,"#")+(new Date).getTime()+Math.floor(1e5*Math.random()),o=_objectSpread(_objectSpread({},t),{},{key:r});return _react2.default.createElement(e,o,null)},pathConvertToCacheKey=function(e){return e.startsWith("/")&&(e=e.substring(1)),e.endsWith("/")&&(e=e.substring(0,e.lenth-1)),e.replace(/\//g,".")};exports.goTo=goTo,exports.goToAndClose=goToAndClose,exports.getNavListFromMenuList=getNavListFromMenuList,exports.isExisedTheUrl=isExisedTheUrl,exports.getPathCompFromKey=getPathCompFromKey,exports.pathConvertToCacheKey=pathConvertToCacheKey;